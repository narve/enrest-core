<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Hello</title>
</head>
<body>

<h1>hello</h1>





<ul>
    <li itemscope>
        <ul>
            <li>Name: <span style="foo" itemprop="name2">Fred</span></li>
            <li>Name: <span itemprop="name">Fred</span></li>
            <li>Phone: <span itemprop="telephone">210-555-5555</span></li>
            <li>Email: <span itemprop="email">thebuffalo@rockandstone.com</span></li>
            <li>Site: <a href="foo.html" itemprop="url">My site</a></li>
        </ul>
    </li>
    <li itemscope>
        <ul>
            <li>Name: <span itemprop="name">Wilma</span></li>
            <li>Phone: <span itemprop="telephone">210-555-7777</span></li>
            <li>Email: <span itemprop="email">thewife@rockandstone.com</span></li>
        </ul>
    </li>
    <li itemscope>
        <ul>
            <li>Name: <span itemprop="name">Betty</span></li>
            <li>Phone: <span itemprop="telephone">210-555-8888</span></li>
            <li>Email: <span itemprop="email">theneighbour@rockandstone.com</span></li>
        </ul>
    </li>
    <li itemscope type="thetype">
        <ul>
            <li>Name: <span itemprop="name">Barny</span></li>
            <li>Phone: <span itemprop="telephone">210-555-0000</span></li>
            <li>Email: <span itemprop="email">thebestfriend@rockandstone.com</span></li>
            <li itemprop="bands" itemscope type="band">
                <span itemprop="bandName">the beatles</span>
            </li>
            <li itemprop="bands" itemscope type="band">
                <span itemprop="bandName2">the beatles2</span>
            </li>
        </ul>
    </li>
</ul>


<script>

    var forEach = Array.prototype.forEach;

    function toItem( node ) {
        var res = {};
        if( node.attributes['type'] ) {
             res.type = node.attributes['type'].value;
        }
        forEach.call( node.querySelectorAll( "*[itemprop]" ), n => {
            res[n.attributes['itemprop'].value] = toPropertyValue( n );
       //      console.log( "The node: ", n );
         });
        return res;
    }

    function toPropertyValue( node ) {
        if( node.attributes["itemscope"] ) {
            return toItem(node);
        } else {
            return node.textContent;
        }
    }

    var list = document.querySelectorAll("*[itemscope]");

    forEach.call(list, n => console.log( "Item: ", toItem(n) ) );
    forEach.call(list, n => console.log( "Properties: ", n.properties ) );

    console.log( "Done. " );
    console.log( document.getItems().length );
    console.log( document.getItems()[3].properties.bands[1].properties.bandName2[0].itemValue );

</script>




</body>
</html>